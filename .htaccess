# ========================================
# TOZRADAR.COM - ROOT .HTACCESS
# ========================================

# Enable Rewrite Engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Force HTTPS (uncomment if you have SSL)
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # Force www or non-www (choose one)
    # RewriteCond %{HTTP_HOST} !^www\. [NC]
    # RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]
    
    # Allow direct access to existing files and directories
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # Don't rewrite for these directories
    RewriteCond %{REQUEST_URI} ^/features/ [OR]
    RewriteCond %{REQUEST_URI} ^/admin/ [OR]
    RewriteCond %{REQUEST_URI} ^/api/ [OR]
    RewriteCond %{REQUEST_URI} ^/assets/ [OR]
    RewriteCond %{REQUEST_URI} ^/uploads/
    RewriteRule ^ - [L]
</IfModule>

# ========================================
# DIRECTORY ACCESS PERMISSIONS
# ========================================

# Allow access to features directory
<Directory "/features">
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    
    <FilesMatch "\.php$">
        Require all granted
    </FilesMatch>
</Directory>

# Allow access to admin directory
<Directory "/admin">
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# Allow access to api directory
<Directory "/api">
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# Protect config files
<FilesMatch "^(config\.php|\.env)$">
    Require all denied
</FilesMatch>

# ========================================
# SECURITY SETTINGS
# ========================================

# Disable directory browsing
Options -Indexes

# Prevent access to hidden files (.htaccess, .git, etc.)
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Protect sensitive files
<FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|orig|psd|sh|sql|sw[op])|~)$">
    Require all denied
</FilesMatch>

# Block access to includes folder
<IfModule mod_rewrite.c>
    RewriteRule ^includes/ - [F,L]
</IfModule>

# Disable server signature
ServerSignature Off

# Prevent clickjacking
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # CORS headers (adjust as needed)
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# ========================================
# PHP SETTINGS
# ========================================

<IfModule mod_php7.c>
    # Memory and upload limits
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value memory_limit 256M
    php_value max_execution_time 300
    php_value max_input_time 300
    
    # Error handling (disable in production)
    php_flag display_errors Off
    php_flag display_startup_errors Off
    php_value error_reporting 0
    
    # Session settings
    php_value session.cookie_httponly 1
    php_value session.cookie_secure 1
    php_value session.use_strict_mode 1
</IfModule>

<IfModule mod_php8.c>
    # Memory and upload limits
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value memory_limit 256M
    php_value max_execution_time 300
    php_value max_input_time 300
    
    # Error handling (disable in production)
    php_flag display_errors Off
    php_flag display_startup_errors Off
    php_value error_reporting 0
    
    # Session settings
    php_value session.cookie_httponly 1
    php_value session.cookie_secure 1
    php_value session.use_strict_mode 1
</IfModule>

# ========================================
# CACHING AND PERFORMANCE
# ========================================

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/
